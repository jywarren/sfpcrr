<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hidden Portals</title>
</head>
<body>
<link rel="stylesheet" href="portals.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ojuju:wght@200..800&family=Oswald:wght@200..700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Ojuju:wght@200..800&family=Oswald:wght@200..700&family=Zilla+Slab:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">


<style>
</style>

<!-- TODO
- try preloading imgs with onLoad() ( preloading is already done somehow? Caching?)
- do it when in closeness*5 distance?
X buzz or flicker when in closeness*5 distance?
- figure out orientation - switch to photo-sphere-viewer
- audio preloading
- debug audio turning off
-->
<div class="text">
<h1>Hidden<br />Portals</h1>

<p>At the sites of 5 historical erased communities of color, portals have been hidden in plain sight. When you approach, the portals will open, allowing a glimpse into virtually reconstructed, immersive moments from their pasts which I and my collaborators have spent the past two years crafting from archival records and photographs, oral histories and other clues.</p> 

<p>Our experiences sifting through archival clues has also revealed how these stories have been historically invisibilized within archival collections. Recognizing this, portals have also been created in and around the Library of Congress in Washington, DC.</p>

<p>These hidden worlds are, by necessity, partial, fleeting, and speculative to varying degrees. In the spirit of Saidiya Hartman’s critical fabulation and the speculative fiction of Linda Sue Park, we have focused on the sensory experiences of place – those knowledges most likely to survive by remaining hidden – rather than the dates and historical facts. By placing these worlds – these reconstructions of lost enclaves – in unmarked spots, I hope they will resist denials, misunderstandings, exoticizing gazes, and re-displacement, through their insubstantial and ghostly presence, impossible to drive out.</p>

<p>Hidden Portals is part of the <a href="https://libraryofcongress.github.io/seeing-lost-enclaves/">Seeing Lost Enclaves</a> project by <a href="https://unterbahn.com">Jeffrey Yoo Warren</a> 2023 Innovator in Residence at the Library of Congress.</p>
</div>

</div>

<div style="display:none;">
  <h1 id="lat"></h1>
  <h1 style="color:red;">41.8213485,-71.4156095</h1>
</div>
<a onclick="showPortal('https://jywarren.github.io/sfpcrr/?embedded&url=images/providence-burrill-stacked-progressive.jpg');">Test Portal</a>

<script>

let locations = [
  { name: 'Providence Coal Fired Pizza', lat: 41.82129802473228, lng: -71.41502773093613, url: 'https://jywarren.github.io/sfpcrr/?embedded&url=images/mapogu.jpg', audio: 'audio/mapogu.m4a'},
  { name: 'Providence Empire St. Chinatown', lat: 41.8213485, lng: -71.4156095, url: 'https://jywarren.github.io/sfpcrr/?embedded&url=images/providence-empire-stacked-progressive.jpg'},
  { name: 'Providence Burrill St. Chinatown', lat: 41.820647, lng: -71.415001, url: 'https://jywarren.github.io/sfpcrr/?embedded&url=images/providence-burrill-stacked-progressive.jpg'},
  { name: 'Portland Chinese Vegetable Gardens', lat: 45.520291, lng: -122.692254, url: 'https://jywarren.github.io/sfpcrr/?embedded&url=images/portland-night.jpg'},
  { name: 'Statue of Confucius', lat: 25.027136, lng: 121.528874, url: 'https://jywarren.github.io/sfpcrr/?embedded&url=images/portland-night.jpg'},
  { name: 'Together Shovel', lat: 41.820824, lng: -71.415476, url: 'https://jywarren.github.io/sfpcrr/?embedded&url=images/shovel.jpg', audio: 'audio/together-shove.mp3'},
  { name: 'Connie', lat: 39.953892, lng: -75.156224, url: 'https://jywarren.github.io/sfpcrr/?embedded&url=images/connie.jpg'},
//  { name: 'Zoe', lat: 39.953892, lng: -75.156224, url: 'https://jywarren.github.io/sfpcrr/zoe/cubemap'},
];

let el = document.createElement('div');
document.body.appendChild(el);
el.classList.add("portalDiv");
el.style="position:absolute;z-index:999;left:50%;bottom:50%;";
el.innerHTML = '<iframe id="portal" src="https://jywarren.github.io/sfpcrr/?embedded&url=images/mapogu.jpg"></iframe>';
el.onclick = function() { portalGrow() };
let portal = document.getElementById('portal');
let audioEl = {};
hidePortal();
function showPortal(src) {
  if (portal.src != src) portal.src = src;
  portalOpen = true;
  el.style.left = '10%';
  el.style.bottom = '10%';
  portal.style.width = '80vw';
  portal.style.height = '80vw';
  portal.style['border-radius'] = '500px';
}
function portalGrow(src) {
  el.style.left = 0;
  el.style.bottom = '-5px';
  portal.style.width = '100vw';
  portal.style.height = '101vh';
  portal.style['border-radius'] = 0;
  portal.style['pointer-events'] = 'all';
  if (audioEl.src) audioEl.play();
}
function hidePortal() {
  el.style.left = '50%';
  el.style.bottom = '50%';
  portal.style['border-radius'] = '500px';
  portal.style.width = 0;
  portal.style.height = 0;
  portal.style['pointer-events'] = 'none';
  if (audioEl.hasOwnProperty(stop)) audioEl.stop();
}
function loadAudio(src) {
  audioEl = new Audio(src);
  /*audioEl.addEventListener("canplaythrough", (event) => {
    audioEl.play(); // doesn't work because it requires user interaction before audio is allowed
  });*/
}

let closeness = 0.0001; // approx 70m in US
let count = 0, // delete this, it's debug
    preservePortal = 0, // leave portal open on a timer
    portalOpen = false;

if (navigator.geolocation) {
  navigator.geolocation.watchPosition((position) => {
      let foundPortal = false, isNearPortal = false;
      document.getElementById('lat').innerHTML = position.coords.latitude + ',' + position.coords.longitude + '<br />'+ count;
      count = count + 1;
      // detect if we're closeness*5 near a portal
      locations.forEach(function(loc) {
        if (Math.abs(loc.lat - position.coords.latitude) < closeness * 5) {
          if (Math.abs(loc.lng - position.coords.longitude) < closeness * 5) {
            isNearPortal = true;
            if (loc.audio) loadAudio(loc.audio); // preload audio
          }
        }
      })
      if (isNearPortal) {
        document.body.classList.add('crt');
      } else {
        document.body.classList.remove('crt');
      }
      // compare and we should be within ~7m or 0.0001 degrees to match 
      locations.forEach(function(loc) {
        if (Math.abs(loc.lat - position.coords.latitude) < closeness) {
          if (Math.abs(loc.lng - position.coords.longitude) < closeness) {
            if (portalOpen == false) {
              showPortal(loc.url);
              if (loc.audio != audioEl.src) loadAudio(loc.audio); // if there's new audio
              preservePortal = 3; // leave portal open for 3 cycles
             }
             foundPortal = true;
          }
        }
      })
      preservePortal = preservePortal - 1;
      if (!foundPortal && preservePortal < 1) {
        hidePortal();
        portalOpen = false;
      }
    },
    () => {
      console.log("There was an error geocoding.");
    },
    {
      enableHighAccuracy: true
    }
  );
} else {
  // Browser doesn't support Geolocation
  console.log("Error: Your browser doesn't support geolocation.");
}

</script>
</body>
</html>
